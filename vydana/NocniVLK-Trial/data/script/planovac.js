const planovac={id_spust:["cas-ulohy","popis-plan","ch-bz","ch-1x","ch-rep"],id_hl_kon:"div-plany",id_box_hl:"box-p",id_butt_box:"butt-edit-p",id_kryt:"kryt-p",id_text:"p-p",id_box_up:"box-uk-p",id_butt_uk:"butt-p",id_butt_zvuk:"zvuk-p",id_hod:"hod-p",id_min:"min-p",id_bud:"bud-p",butt_spust:"form-plan",plany:[[],[],[],[],[],[]],hlidat_plany:false,v_alarmu:["","","","","",""],povoleni_zesilovat:false,id_nas_plan:["hod-p-n","min-p-n","plan-pop-n","ch-bz-n","ch-1x-n","ch-rep-n"],eduje_se:null,data_v_alarmu:[[],[],[],[],[],[]],_css:["d-n","zar","budik","zar-nonstop","bl33"],min_pres:30,posON_spust(){document.getElementById(this.id_spust[2]).addEventListener("input",this);document.getElementById(this.id_spust[3]).addEventListener("input",this);document.getElementById(this.id_spust[4]).addEventListener("input",this);document.getElementById(this.butt_spust).addEventListener("submit",this);},posOFF_spust(){document.getElementById(this.id_spust[2]).removeEventListener("input",this);document.getElementById(this.id_spust[3]).removeEventListener("input",this);document.getElementById(this.id_spust[4]).removeEventListener("input",this);document.getElementById(this.butt_spust).removeEventListener("submit",this);},handleEvent(e){const k=e.target.id;if(k==this.id_spust[2]||k==this.id_spust[3]||k==this.id_spust[4]){klik.hraj(false);const ch1=document.getElementById(this.id_spust[2]);const ch2=document.getElementById(this.id_spust[3]);const ch3=document.getElementById(this.id_spust[4]);if(k==this.id_spust[2]){ch1.checked=true;ch2.checked=false;ch3.checked=false;}else if(k==this.id_spust[3]){ch1.checked=false;ch2.checked=true;ch3.checked=false;}else if(k==this.id_spust[4]){ch1.checked=false;ch2.checked=false;ch3.checked=true;}}else if(k==this.id_nas_plan[3]||k==this.id_nas_plan[4]||k==this.id_nas_plan[5]){klik.hraj(false);const ch1=document.getElementById(this.id_nas_plan[3]);const ch2=document.getElementById(this.id_nas_plan[4]);const ch3=document.getElementById(this.id_nas_plan[5]);const plan=this.eduje_se;const cislo_pole=plan-1;let zmena="";if(k==this.id_nas_plan[3]){ch1.checked=true;ch2.checked=false;ch3.checked=false;zmena=false;}else if(k==this.id_nas_plan[4]){ch1.checked=false;ch2.checked=true;ch3.checked=false;zmena=null;}else if(k==this.id_nas_plan[5]){ch1.checked=false;ch2.checked=false;ch3.checked=true;zmena=true;}this.plany[cislo_pole][3]=zmena;uloz.plany();}else if(k==this.butt_spust){if(this.plany[0].length==0){zamek.blok();window.onbeforeunload=()=>{return "Chcete zavřít aplikaci Noční VLK?";};this.zaloz(1);}else if(this.plany[1].length==0){this.zaloz(2);}else if(this.plany[2].length==0){this.zaloz(3);}else if(this.plany[3].length==0){this.zaloz(4);}else if(this.plany[4].length==0){this.zaloz(5);}else if(this.plany[5].length==0){this.zaloz(6);}}else if(k==`${this.id_butt_uk}1`){this.ukoncit(1);}else if(k==`${this.id_butt_uk}2`){this.ukoncit(2);}else if(k==`${this.id_butt_uk}3`){this.ukoncit(3);}else if(k==`${this.id_butt_uk}4`){this.ukoncit(4);}else if(k==`${this.id_butt_uk}5`){this.ukoncit(5);}else if(k==`${this.id_butt_uk}6`){this.ukoncit(6);}else if(k==`${this.id_butt_zvuk}1`||k==`${this.id_butt_zvuk}2`||k==`${this.id_butt_zvuk}3`||k==`${this.id_butt_zvuk}4`||k==`${this.id_butt_zvuk}5`||k==`${this.id_butt_zvuk}6`){zvuk_plan.zastav();this.povoleni_zesilovat=false;}else if(k==`${this.id_butt_box}1`||k==`${this.id_text}1`||k==`${this.id_kryt}1`){dia.on(dia.id[13]);this.eduje_se=1;this.editovat(1);}else if(k==`${this.id_butt_box}2`||k==`${this.id_text}2`||k==`${this.id_kryt}2`){dia.on(dia.id[13]);this.eduje_se=2;this.editovat(2);}else if(k==`${this.id_butt_box}3`||k==`${this.id_text}3`||k==`${this.id_kryt}3`){dia.on(dia.id[13]);this.eduje_se=3;this.editovat(3);}else if(k==`${this.id_butt_box}4`||k==`${this.id_text}4`||k==`${this.id_kryt}4`){dia.on(dia.id[13]);this.eduje_se=4;this.editovat(4);}else if(k==`${this.id_butt_box}5`||k==`${this.id_text}5`||k==`${this.id_kryt}5`){dia.on(dia.id[13]);this.eduje_se=5;this.editovat(5);}else if(k==`${this.id_butt_box}6`||k==`${this.id_text}6`||k==`${this.id_kryt}6`){dia.on(dia.id[13]);this.eduje_se=6;this.editovat(6);}},zaloz(plan=0){if(plan==0){return;}const hodin=parseInt(document.getElementById(this.id_spust[0]).value[0]+document.getElementById(this.id_spust[0]).value[1]);const minut=parseInt(document.getElementById(this.id_spust[0]).value[3]+document.getElementById(this.id_spust[0]).value[4]);const duplicita=this.duplicitni_cas(hodin,minut);if(duplicita){return;}hlidac.planovac=true;let minut_text=minut;if(minut_text<10){minut_text=`0${minut_text}`;}const text=document.getElementById(this.id_spust[1]).value;document.getElementById(`${this.id_box_hl}${plan}`).style.opacity=1;document.getElementById(`${this.id_hl_kon}`).classList.remove(this._css[0]);document.getElementById(`${this.id_box_hl}${plan}`).classList.remove(this._css[0]);document.getElementById(`${this.id_hod}${plan}`).innerText=hodin;document.getElementById(`${this.id_min}${plan}`).innerText=minut_text;document.getElementById(`${this.id_text}${plan}`).innerText=text;this.sroll_na(plan);setTimeout(()=>{this.sroll_na(plan);},500);setTimeout(()=>{document.getElementById(`${this.id_box_hl}${plan}`).classList.add(this._css[1]);},1000);const ch1=document.getElementById(this.id_spust[2]).checked;const ch2=document.getElementById(this.id_spust[3]).checked;const ch3=document.getElementById(this.id_spust[4]).checked;let zvuk=null;if(ch1==true){zvuk=false;}else if(ch2==true){zvuk=null;}else if(ch3==true){zvuk=true;}const cislo_pole_planu=plan-1;this.plany[cislo_pole_planu].push(hodin);this.plany[cislo_pole_planu].push(minut);this.plany[cislo_pole_planu].push(text);this.plany[cislo_pole_planu].push(zvuk);uloz.plany();document.getElementById(`${this.id_butt_box}${plan}`).addEventListener("click",this);dia.off(dia.id[4]);this.hlidat_plany=true;zvuk_plan.hraj(null);if(this.plany[1].length!=0){setTimeout(()=>{this.seradit_plady();},2000);}},seradit_plady(){if(this.v_alarmu[0]==true||this.v_alarmu[1]==true||this.v_alarmu[2]==true||this.v_alarmu[3]==true||this.v_alarmu[4]==true||this.v_alarmu[5]==true){setTimeout(()=>{this.seradit_plady();},5000);return;}const cas=new Date();const hod=cas.getHours();const min=cas.getMinutes();const aktualne_celkem_minut=hod*60+min;let cas_plan=null;const plany_k_serazeni=[];if(this.plany[0].length!=0){cas_plan=this.plany[0][0]*60+this.plany[0][1];if(cas_plan<aktualne_celkem_minut){cas_plan+=1440;}plany_k_serazeni.push([1,cas_plan]);}if(this.plany[1].length!=0){cas_plan=this.plany[1][0]*60+this.plany[1][1];if(cas_plan<aktualne_celkem_minut){cas_plan+=1440;}plany_k_serazeni.push([2,cas_plan]);}if(this.plany[2].length!=0){cas_plan=this.plany[2][0]*60+this.plany[2][1];if(cas_plan<aktualne_celkem_minut){cas_plan+=1440;}plany_k_serazeni.push([3,cas_plan]);}if(this.plany[3].length!=0){cas_plan=this.plany[3][0]*60+this.plany[3][1];if(cas_plan<aktualne_celkem_minut){cas_plan+=1440;}plany_k_serazeni.push([4,cas_plan]);}if(this.plany[4].length!=0){cas_plan=this.plany[4][0]*60+this.plany[4][1];if(cas_plan<aktualne_celkem_minut){cas_plan+=1440;}plany_k_serazeni.push([5,cas_plan]);}if(this.plany[5].length!=0){cas_plan=this.plany[5][0]*60+this.plany[5][1];if(cas_plan<aktualne_celkem_minut){cas_plan+=1440;}plany_k_serazeni.push([6,cas_plan]);}const delka_uloh=plany_k_serazeni.length;console.log(delka_uloh);if(delka_uloh<=1){console.log("return");return;}const hodnoty_casu_k_porovnani=[];for(let i=0;i<delka_uloh;i++){hodnoty_casu_k_porovnani.push(plany_k_serazeni[i][1]);}hodnoty_casu_k_porovnani.sort((a,b)=>{return a-b});let d_hodnoty_casu=hodnoty_casu_k_porovnani.length;const razeni_planu=[];for(let k=0;k<d_hodnoty_casu;k++){for(let i=0;i<delka_uloh;i++){if(hodnoty_casu_k_porovnani[k]==plany_k_serazeni[i][1]){razeni_planu.push(plany_k_serazeni[i][0]);}}}const spravne_razeni=razeni_planu.slice();spravne_razeni.sort((a,b)=>{return a-b});const d_razeni_planu=razeni_planu.length;for(let i=0;i<d_razeni_planu;i++){if(razeni_planu[i]!=spravne_razeni[i]){this.prepis_planu(razeni_planu);break;}}},prepis_planu(poradi){this.hlidat_plany=false;dia.vyp_akt();document.getElementById(this.id_hl_kon).style.opacity=0.2;setTimeout(()=>{document.getElementById(this.id_hl_kon).style.opacity=1;},300);const nove_poradi=poradi;const delka_nove_poradi=nove_poradi.length;const new_plany=[];for(let i=0;i<delka_nove_poradi;i++){new_plany.push(this.plany[nove_poradi[i]-1]);}let delka_old_plany=this.plany.length;this.plany=new_plany;let delka_plany=this.plany.length;for(let i=0;i<delka_plany;i++){let plan=i+1;let hodin=this.plany[i][0];let minut_text=this.plany[i][1];if(minut_text<10){minut_text=`0${minut_text}`;}let text=this.plany[i][2];document.getElementById(`${this.id_hod}${plan}`).innerText=hodin;document.getElementById(`${this.id_min}${plan}`).innerText=minut_text;document.getElementById(`${this.id_text}${plan}`).innerText=text;}for(let i=0;delka_plany<delka_old_plany;delka_plany++){this.plany.push([]);}uloz.plany();this.hlidat_plany=true;},duplicitni_cas(hod,min){const kontrolor=[null,null,null,null,null,null];const d=kontrolor.length;for(let i=0;i<d;i++){if(this.plany[i].length!=0){if(this.plany[i][0]==hod&&this.plany[i][1]==min){kontrolor[i]=true;}}}if(kontrolor[0]==true||kontrolor[1]==true||kontrolor[2]==true||kontrolor[3]==true||kontrolor[4]==true||kontrolor[5]==true){dia.off(dia.id[4]);let plan=null;if(kontrolor[0]==true){plan=1;}else if(kontrolor[1]==true){plan=2;}else if(kontrolor[2]==true){plan=3;}else if(kontrolor[3]==true){plan=4;}else if(kontrolor[4]==true){plan=5;}else if(kontrolor[5]==true){plan=6;}document.getElementById(`${this.id_box_hl}${plan}`).classList.remove(this._css[1]);this.sroll_na(plan);setTimeout(()=>{this.sroll_na(plan);},500);setTimeout(()=>{document.getElementById(`${this.id_box_hl}${plan}`).classList.add(this._css[1]);zvuk_plan.hraj(false);},750);return true;}else{return false;}},editovat(plan){klik.hraj(false);const plan_pole=plan-1;const hodina_planu=this.plany[plan_pole][0];let minuta_planu=this.plany[plan_pole][1];const text_planu=this.plany[plan_pole][2];const volba_zvuku=this.plany[plan_pole][3];if(minuta_planu<10){minuta_planu=`0${minuta_planu}`;}const dia_hodina=document.getElementById(this.id_nas_plan[0]);dia_hodina.innerText=hodina_planu;const dia_minuta=document.getElementById(this.id_nas_plan[1]);dia_minuta.innerText=minuta_planu;const dia_text=document.getElementById(this.id_nas_plan[2]);dia_text.innerText=text_planu;const dia_ch1=document.getElementById(this.id_nas_plan[3]);const dia_ch2=document.getElementById(this.id_nas_plan[4]);const dia_ch3=document.getElementById(this.id_nas_plan[5]);if(volba_zvuku){dia_ch1.checked=false;dia_ch2.checked=false;dia_ch3.checked=true;}else if(volba_zvuku==false){dia_ch1.checked=true;dia_ch2.checked=false;dia_ch3.checked=false;}else if(volba_zvuku==null){dia_ch1.checked=false;dia_ch2.checked=true;dia_ch3.checked=false;}},nas_posON(){document.getElementById(this.id_nas_plan[3]).addEventListener("click",this);document.getElementById(this.id_nas_plan[4]).addEventListener("click",this);document.getElementById(this.id_nas_plan[5]).addEventListener("click",this);},nas_posOFF(){document.getElementById(this.id_nas_plan[3]).removeEventListener("click",this);document.getElementById(this.id_nas_plan[4]).removeEventListener("click",this);document.getElementById(this.id_nas_plan[5]).removeEventListener("click",this);},hlidac(){console.log("hlidac");const plan=[null,null,null,null,null,null];const plany_ke_kontrole=[];if(this.plany[0].length!=0){plan[0]=true;plany_ke_kontrole.push(1);}if(this.plany[1].length!=0){plan[1]=true;plany_ke_kontrole.push(2);}if(this.plany[2].length!=0){plan[2]=true;plany_ke_kontrole.push(3);}if(this.plany[3].length!=0){plan[3]=true;plany_ke_kontrole.push(4);}if(this.plany[4].length!=0){plan[4]=true;plany_ke_kontrole.push(5);}if(this.plany[5].length!=0){plan[5]=true;plany_ke_kontrole.push(6);}if(plan[0]==null&&plan[1]==null&&plan[2]==null&&plan[3]==null&&plan[4]==null&&plan[5]==null){this.hlidat_plany=false;hlidac.planovac=false;return;}const delka=plany_ke_kontrole.length;for(let i=0;i<delka;i++){const cas=new Date();const hod=cas.getHours();const min=cas.getMinutes();const z_hod=this.plany[plany_ke_kontrole[i]-1][0];const z_min=this.plany[plany_ke_kontrole[i]-1][1];if(hod==z_hod&&min==z_min){if(hl_kon.otevrene_okno!=""){planovac.hlidat_plany=false;hl_kon.otevri(hl_kon.otevrene_okno);setTimeout(()=>{this.alarm(plany_ke_kontrole[i]);},500);setTimeout(()=>{planovac.hlidat_plany=true;},1000);}else{this.alarm(plany_ke_kontrole[i]);}}}},alarm(plan){dia.vyp_akt();this.sroll_na(plan);setTimeout(()=>{this.sroll_na(plan);},500);document.getElementById(`${this.id_butt_box}${plan}`).removeEventListener("click",this);document.getElementById(`${this.id_butt_box}${plan}`).classList.remove(this._css[4]);document.getElementById(`${this.id_box_hl}${plan}`).classList.remove(this._css[1]);document.getElementById(`${this.id_bud}${plan}`).classList.add(this._css[2]);document.getElementById(`${this.id_box_hl}${plan}`).classList.add(this._css[3]);document.getElementById(`${this.id_box_up}${plan}`).classList.remove(this._css[0]);if(this.plany[plan-1][3]==true){document.getElementById(`${this.id_butt_zvuk}${plan}`).classList.remove(this._css[0]);document.getElementById(`${this.id_butt_zvuk}${plan}`).addEventListener("click",this);zvuk_plan.hraj(true);this.povoleni_zesilovat=true;}else{document.getElementById(`${this.id_butt_zvuk}${plan}`).classList.add(this._css[0]);if(this.plany[plan-1][3]==null){this.povoleni_zesilovat=false;zvuk_plan.hraj(false);}}document.getElementById(`${this.id_butt_uk}${plan}`).addEventListener("click",this);this.v_alarmu[plan-1]=true;this.data_v_alarmu[plan-1]=this.plany[plan-1];uloz.plany_v_alarmu();this.anuluj_plan(plan);},anuluj_plan(plan){const cislo_pole_planu=plan-1;this.plany[cislo_pole_planu]=[];uloz.plany();},ukoncit(plan){document.getElementById(`${this.id_butt_uk}${plan}`).removeEventListener("click",this);document.getElementById(`${this.id_butt_zvuk}${plan}`).removeEventListener("click",this);zvuk_plan.zastav();document.getElementById(`${this.id_box_hl}${plan}`).style.opacity=0;setTimeout(()=>{document.getElementById(`${this.id_bud}${plan}`).classList.remove(this._css[2]);document.getElementById(`${this.id_box_hl}${plan}`).classList.remove(this._css[3]);document.getElementById(`${this.id_butt_box}${plan}`).classList.add(this._css[4]);document.getElementById(`${this.id_box_up}${plan}`).classList.add(this._css[0]);document.getElementById(`${this.id_box_hl}${plan}`).classList.add(this._css[0]);document.getElementById(`${this.id_box_hl}${plan}`).classList.remove(this._css[1]);},300);this.v_alarmu[plan-1]="";this.data_v_alarmu[plan-1]=[];uloz.plany_v_alarmu();if(this.plany[0].length==0&&this.plany[1].length==0&&this.plany[2].length==0&&this.plany[3].length==0&&this.plany[4].length==0&&this.plany[5].length==0&&this.v_alarmu[0]!=true&&this.v_alarmu[1]!=true&&this.v_alarmu[2]!=true&&this.v_alarmu[3]!=true&&this.v_alarmu[4]!=true&&this.v_alarmu[5]!=true){setTimeout(()=>{document.getElementById(`${this.id_hl_kon}`).classList.add(this._css[0]);},500);}},sroll_na(plan=0){if(plan==0){return;}document.getElementById(`${this.id_box_hl}${plan}`).scrollIntoView({behavior:"smooth",block:"center"});},zapnout_alarm_plan(){const cas=new Date();const hod=cas.getHours();const min=cas.getMinutes();const aktualne_celkem_minut=hod*60+min;let plan=[[null],[null],[null],[null],[null],[null]];const plany_ke_kontrole=[];if(this.plany[0].length!=0){plan[0]=true;plany_ke_kontrole.push(1);}if(this.plany[1].length!=0){plan[1]=true;plany_ke_kontrole.push(2);}if(this.plany[2].length!=0){plan[2]=true;plany_ke_kontrole.push(3);}if(this.plany[3].length!=0){plan[3]=true;plany_ke_kontrole.push(4);}if(this.plany[4].length!=0){plan[4]=true;plany_ke_kontrole.push(5);}if(this.plany[5].length!=0){plan[5]=true;plany_ke_kontrole.push(6);}let delka_plany_ke_kontrole=plany_ke_kontrole.length;if(delka_plany_ke_kontrole!=0){for(let i=0;i<delka_plany_ke_kontrole;i++){let hodina_planu=this.plany[plany_ke_kontrole[i]-1][0];let minuta_planu=this.plany[plany_ke_kontrole[i]-1][1];let c_cas=hodina_planu*60+minuta_planu;if(((aktualne_celkem_minut-c_cas)>0)&&((aktualne_celkem_minut-c_cas)<=this.min_pres)){this.alarm(plany_ke_kontrole[i]);}}}},ozivit(){if(!uloz.ok){return;}zvuk_plan.hraj(null);zamek.blok();window.hlidac.aktivace();hlidac.planovac=true;window.onbeforeunload=()=>{return "Chcete zavřít aplikaci Noční VLK?";};let data_plany=uloz.nacti(uloz.klice[22]);let plany="";if(data_plany!=""){try{plany=JSON.parse(data_plany);}catch(e){plany=[[],[],[],[],[],[]];console.log("plány načtení chyba: "+e);}}else{plany=[[],[],[],[],[],[]];}const plany_k_predani=plany.slice();const delka_plany=plany.length;let data_v_alarmu=uloz.nacti(uloz.klice[23]);let v_alarmu="";if(data_v_alarmu!=""){try{v_alarmu=JSON.parse(data_v_alarmu);}catch(e){console.log("plány v alarmu načtení chyba: "+e);}}if(v_alarmu!=""){for(let i=0;i<delka_plany;i++){let kontrola_v_alarmu=v_alarmu[i];if(kontrola_v_alarmu.length!=0){this.plany[i]=v_alarmu[i];plany[i]=v_alarmu[i];this.alarm(i+1);}}}else{v_alarmu=[[],[],[],[],[],[]];}let ktere_plany=[];for(let i=0;i<delka_plany;i++){if(plany[i].length!=0){ktere_plany.push(true);}else{ktere_plany.push(false);}}document.getElementById(`${this.id_hl_kon}`).classList.remove(this._css[0]);for(let i=0;i<delka_plany;i++){if(ktere_plany[i]){document.getElementById(`${this.id_box_hl}${i+1}`).classList.remove(this._css[0]);document.getElementById(`${this.id_hod}${i+1}`).innerText=plany[i][0];let minut=parseInt(plany[i][1]);if(minut<10){minut=`0${minut}`;}document.getElementById(`${this.id_min}${i+1}`).innerText=minut;document.getElementById(`${this.id_text}${i+1}`).innerText=plany[i][2];if(v_alarmu[i].length==0){document.getElementById(`${this.id_butt_box}${i+1}`).addEventListener("click",this);setTimeout(()=>{document.getElementById(`${this.id_box_hl}${[i+1]}`).classList.add(this._css[1]);},250+500*i);}}}this.plany=plany_k_predani.slice();uloz.plany();this.zapnout_alarm_plan();this.hlidat_plany=true;setTimeout(()=>{this.seradit_plady();},2000);},ma_se_ozivit(){if(!uloz.ok){return false;}let plany=true;let data_plany=uloz.nacti(uloz.klice[22]);if(data_plany==""){plany=false;}else{let plany_pole="";try{plany_pole=JSON.parse(data_plany);}catch(e){plany=false;console.log("plány načtení chyba: "+e);}if(plany_pole[0].length==0&&plany_pole[1].length==0&&plany_pole[2].length==0&&plany_pole[3].length==0&&plany_pole[4].length==0&&plany_pole[5].length==0){plany=false;}}let v_alarmu=true;let data_v_alarmu=uloz.nacti(uloz.klice[23]);let pole_alarmu="";if(data_v_alarmu!=""){try{pole_alarmu=JSON.parse(data_v_alarmu);}catch(e){v_alarmu=false;}if(pole_alarmu[0].length==0&&pole_alarmu[1].length==0&&pole_alarmu[2].length==0&&pole_alarmu[3].length==0&&pole_alarmu[4].length==0&&pole_alarmu[5].length==0){v_alarmu=false;}}else{v_alarmu=false;}if(plany==true||v_alarmu==true){return true;}else{return false;}}};pripravenost.planovac=true;